setup_seljuk_invasion_byzantium_character_effect = {
	if = {
		limit = {
			can_use_suleyman = yes
		}
		setup_suleyman_seljuk_invasion_byzantium_effect = yes
	}
	else = {
		spawn_seljuk_invasion_byzantium_character_effect = yes
	}
	setup_seljuk_knights_effect = yes
}

setup_suleyman_seljuk_invasion_byzantium_effect = {
	character:3046 = {
		save_scope_as = seljuk_byzantium_invader
		add_character_flag = is_seljuk
		add_gold = medium_gold_max_value
		add_prestige = massive_prestige_value
		add_piety = massive_piety_value
		ordered_army = { set_army_location = title:c_edessa.holder.capital_province }
		if = {
			limit = {
				has_game_rule = invader_turkmen_culture
			}
			convert_family_culture_and_notify_vassals_effect = {
				CONVERTER = root
				OLD_CULTURE = root.culture
				NEW_CULTURE = culture:turkmen
			}
		}
	}
}

spawn_seljuk_invasion_byzantium_character_effect = {
	if = {
		limit = {
			exists = title:e_persia.holder
		}
		title:e_persia.holder = {
			culture = { save_scope_as = seljuk_birth_culture }
			faith = { save_scope_as = seljuk_birth_faith }
			house = { save_scope_as = seljuk_birth_house }
		}
	}
	else = {
		culture:turkish = { save_scope_as = seljuk_birth_culture }
		faith:maturidi = { save_scope_as = seljuk_birth_faith }
		house:house_seljuk = { save_scope_as = seljuk_birth_house }
	}
	
	if = {
		limit = {
			has_game_rule = invader_turkmen_culture
		}
		culture:turkmen = { save_scope_as = seljuk_birth_culture }
	}
	
	title:c_edessa.holder.capital_province = { save_scope_as = seljuk_birthplace }
	
	create_character = {
		age = { 25 32 }
		location = scope:seljuk_birthplace
		gender_female_chance = fp3_chance_female_leader
		culture = scope:seljuk_birth_culture
		faith = scope:seljuk_birth_faith
		trait = wrathful
		trait = ambitious
		trait = arrogant
		trait = education_martial_3
		trait = rough_terrain_expert
		martial = 15
		stewardship = 8
		diplomacy = 7
		intrigue = 4
		learning = 5
		prowess	 = 11
		
		dynasty_house = scope:seljuk_birth_house
		
		after_creation = {
			add_gold = medium_gold_max_value
			add_prestige = massive_prestige_value
			add_piety = massive_piety_value
			add_perk = stalwart_leader_perk
			add_perk = engineered_for_destruction_perk
			add_perk = hit_and_run_perk
			add_perk = organized_retreat_perk
			add_martial_lifestyle_xp = 10000
			add_trait = strong
			add_character_flag = is_seljuk
			give_seljuk_invasion_byzantium_title_effect = yes
			game_rule_create_spouse_and_children = { CHARACTER = this }
			add_trait_xp = {
				trait = rough_terrain_expert
				value = 100
			}
		}
		save_scope_as = seljuk_byzantium_invader
	}
}

setup_seljuk_knights_effect = {
	add_seljuk_knight_effect = yes
	add_seljuk_knight_effect = yes
	add_seljuk_knight_effect = yes
	add_seljuk_knight_effect = yes
	add_seljuk_knight_effect = yes
	add_seljuk_knight_effect = yes
}

add_seljuk_knight_effect = {
	create_character = {
		employer = scope:seljuk_byzantium_invader
		faith = scope:seljuk_byzantium_invader.faith
		culture = scope:seljuk_byzantium_invader.culture
		template = pool_repopulate_prowess
		prowess = { 17 22 }
		save_scope_as = knight
	}
}

## Set up default title
give_seljuk_invasion_byzantium_title_effect = {
	create_dynamic_title = {
		tier = duchy
		name = seljuk_invaders_temp_title_name
		adj = fp3_seljuk_horde_title_adj
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}
	
	scope:new_title = {
		set_capital_county = scope:seljuk_birthplace.county
		set_landless_title = yes
		set_coa = scope:seljuk_byzantium_invader.house
		set_destroy_on_succession = yes
		set_delete_on_destroy = yes
		set_no_automatic_claims = yes
		set_definitive_form = yes
		set_can_be_named_after_dynasty = no
		set_can_use_nomadic_naming = no
		change_title_holder = {
			holder = scope:seljuk_byzantium_invader
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

spawn_seljuk_invasion_byzantium_troops = {
	spawn_temp_nomadic_troops = yes
	spawn_temp_nomadic_troops = yes
	spawn_temp_nomadic_troops = yes
}

# troops will disband after the war
spawn_temp_nomadic_troops = {
	spawn_army = {
		name = turkmen_nomads
		levies = 500
		men_at_arms = {
			type = armored_footmen
			stacks = 8
		}
		men_at_arms = {
			type = pikemen_unit
			stacks = 8
		}
		men_at_arms = {
			type = steppe_raiders
			stacks = 8
		}
		men_at_arms = {
			type = horse_archers
			stacks = 8
		}
		men_at_arms = {
			type = cataphract_archers
			stacks = 8
		}
		men_at_arms = {
			type = mangonel
			stacks = 8
		}
		location = scope:seljuk_byzantium_invader.location
		war = scope:seljuk_byzantium_invasion_war
		uses_supply = no
	}
}

seljuk_invader_create_duchies_and_convert_effect = {
	this = { save_scope_as = new_owner }
	
	title:d_anatolia = { add_to_list = to_create_convert }
	title:d_cappadocia = { add_to_list = to_create_convert }
	title:d_charsianon = { add_to_list = to_create_convert }
	title:d_sebasteia = { add_to_list = to_create_convert }
	
	every_in_list = {
		list = to_create_convert
		# create duchy
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		change_title_holder = {
			holder = scope:new_owner
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change
		every_de_jure_county = {
			if = {
				limit = {
					culture = culture:greek
				}
				# convert culture (if greek)
				set_county_culture = scope:new_owner.culture
			}
			# convert faith
			set_county_faith = scope:new_owner.faith
		}
	}
}

seljuk_invader_modifier_effect = {
	every_sub_realm_county = {
		change_county_control = 75
		add_county_modifier = {
			modifier = seljuk_invader_county_modifier
			years = 10
		}
	}
}

rum_de_jure_duchies_effect = {
	title:d_anatolia = {
		set_de_jure_liege_title = title:k_rum
	}
	title:d_cappadocia = {
		set_de_jure_liege_title = title:k_rum
	}
	title:d_sebasteia = {
		set_de_jure_liege_title = title:k_rum
	}
	title:d_charsianon = {
		set_de_jure_liege_title = title:k_rum
	}
	title:d_cibyrrhaeot = {
		set_de_jure_liege_title = title:k_rum
	}
	title:d_cilicia = {
		set_de_jure_liege_title = title:k_rum
	}
}

spawn_maa_rum_effect = {
	title:k_rum.holder = {
		create_maa_or_upgrade_regiment_effect = {
			TYPE = armored_footmen
			SIZE = 6
		}
		create_maa_or_upgrade_regiment_effect = {
			TYPE = pikemen_unit
			SIZE = 6
		}
		create_maa_or_upgrade_regiment_effect = {
			TYPE = light_horsemen
			SIZE = 6
		}
		create_maa_or_upgrade_regiment_effect = {
			TYPE = horse_archers
			SIZE = 6
		}
		create_maa_or_upgrade_regiment_effect = {
			TYPE = mangonel
			SIZE = 6
		}
		if = {
			limit = {
				OR = {
					has_trait = sultan_rum
					has_trait = sultan_rum_major
				}
			}
			create_maa_or_upgrade_regiment_effect = {
				TYPE = horse_archers
				SIZE = 6
			}
		}
	}
}

add_sultan_rum_trait_effect = {
	if = {
		limit = {
			game_start_date = 1178.10.1
		}
		if = {
			limit = {
				has_game_rule = sultan_rum_trait_major_1178
			}
			add_trait = sultan_rum_major
		}
		else_if = {
			limit = {
				has_game_rule = sultan_rum_trait_moderate_1178
			}
			add_trait = sultan_rum
		}
		else_if = {
			limit = {
				has_game_rule = sultan_rum_trait_minor_1178
			}
			add_trait = sultan_rum_minor
		}
	}
	else = {
		if = {
			limit = {
				has_game_rule = sultan_rum_trait_major
			}
			add_trait = sultan_rum_major
		}
		else_if = {
			limit = {
				has_game_rule = sultan_rum_trait_moderate
			}
			add_trait = sultan_rum
		}
		else_if = {
			limit = {
				has_game_rule = sultan_rum_trait_minor
			}
			add_trait = sultan_rum_minor
		}
	}
}

remove_sultan_rum_trait_effect = {
	if = {
		limit = {
			has_trait = sultan_rum_major
		}
		remove_trait = sultan_rum_major
	}
	if = {
		limit = {
			has_trait = sultan_rum
		}
		remove_trait = sultan_rum
	}
	if = {
		limit = {
			has_trait = sultan_rum_minor
		}
		remove_trait = sultan_rum_minor
	}
}

create_rum_1187_maa_effect = {
	create_maa_or_upgrade_regiment_effect = {
		TYPE = armored_footmen
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = pikemen_unit
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = light_horsemen
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = bowmen
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = light_footmen
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = horse_archers
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = armored_horsemen
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = trebuchet
		SIZE = 10
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = cataphract_archers
		SIZE = 10
	}
}