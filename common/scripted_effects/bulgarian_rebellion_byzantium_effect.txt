spawn_bulgarian_rebellion_byzantium_character_effect = {
	create_character = {
		age = { 22 25 }
		location = title:c_turnovo.holder.capital_province
		gender_female_chance = fp3_chance_female_leader
		culture = culture:bulgarian
		faith = faith:orthodox
		trait = compassionate
		trait = ambitious
		trait = zealous
		trait = education_stewardship_3
		trait = shrewd
		martial = 4
		stewardship = 14
		diplomacy = 12
		intrigue = 7
		learning = 9
		prowess	 = 3
		
		after_creation = {
			add_gold = medium_gold_max_value
			add_prestige = medium_prestige_value
			add_piety = major_piety_value
			add_stewardship_lifestyle_xp = 10000
			add_character_flag = is_seljuk # makes the character immune to factions
			give_bulgarian_rebellion_byzantium_title_effect = yes
		}
		save_scope_as = bulgarian_rebellion_byzantium_leader
	}
	add_bulgarian_knight_effect = yes
	add_bulgarian_knight_effect = yes
	add_bulgarian_knight_effect = yes
	add_bulgarian_knight_effect = yes
	add_bulgarian_knight_effect = yes
	add_bulgarian_knight_effect = yes
}

add_bulgarian_knight_effect = {
	create_character = {
		employer = scope:bulgarian_rebellion_byzantium_leader
		faith = scope:bulgarian_rebellion_byzantium_leader.faith
		culture = scope:bulgarian_rebellion_byzantium_leader.culture
		template = pool_repopulate_prowess
		prowess = { 17 22 }
		save_scope_as = knight
	}
}

## Set up default title
give_bulgarian_rebellion_byzantium_title_effect = {
	create_dynamic_title = {
		tier = duchy
		name = bulgarian_rebellion_temp_title_name
		adj = bulgarian
	}
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}
	
	scope:new_title = {
		set_capital_county = title:c_turnovo
		set_coa = k_bulgaria
		set_landless_title = yes
		set_destroy_on_succession = yes
		set_delete_on_destroy = yes
		set_no_automatic_claims = yes
		set_definitive_form = yes
		set_can_be_named_after_dynasty = no
		set_can_use_nomadic_naming = no
		change_title_holder = {
			holder = scope:bulgarian_rebellion_byzantium_leader
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

spawn_bulgarian_rebellion_byzantium_troops = {
	spawn_army = {
		name = culture_separatists
		levies = 2500
		men_at_arms = {
			type = handpicked_faithful
			stacks = 10
		}
		men_at_arms = {
			type = trebuchet
			stacks = 10
		}
		location = scope:bulgarian_rebellion_byzantium_leader.location
		war = scope:bulgarian_rebellion_byzantium_war
		uses_supply = no
	}
	spawn_army = {
		name = culture_separatists
		levies = 2500
		men_at_arms = {
			type = handpicked_faithful
			stacks = 10
		}
		men_at_arms = {
			type = trebuchet
			stacks = 10
		}
		location = scope:bulgarian_rebellion_byzantium_leader.location
		war = scope:bulgarian_rebellion_byzantium_war
		uses_supply = no
	}
	spawn_army = {
		name = culture_separatists
		levies = 2500
		men_at_arms = {
			type = handpicked_faithful
			stacks = 10
		}
		men_at_arms = {
			type = trebuchet
			stacks = 10
		}
		location = scope:bulgarian_rebellion_byzantium_leader.location
		war = scope:bulgarian_rebellion_byzantium_war
		uses_supply = no
	}
	spawn_army = {
		name = culture_separatists
		men_at_arms = {
			type = armored_footmen
			stacks = 10
		}
		men_at_arms = {
			type = armored_footmen
			stacks = 10
		}
		men_at_arms = {
			type = hussar
			stacks = 10
		}
		men_at_arms = {
			type = hussar
			stacks = 10
		}
		men_at_arms = {
			type = crossbowmen
			stacks = 10
		}
		men_at_arms = {
			type = trebuchet
			stacks = 10
		}
		location = scope:bulgarian_rebellion_byzantium_leader.location
		war = scope:bulgarian_rebellion_byzantium_war
		uses_supply = no
	}
}

bulgarian_rebellion_byzantium_modifier_effect = {
	every_sub_realm_county = {
		change_county_control = 75
		add_county_modifier = {
			modifier = bulgarian_rebellion_county_modifier
			years = 10
		}
	}
}

spawn_maa_bulgaria_effect = {
	create_maa_or_upgrade_regiment_effect = {
		TYPE = armored_footmen
		SIZE = 8
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = pikemen_unit
		SIZE = 8
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = hussar
		SIZE = 8
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = armored_horsemen
		SIZE = 8
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = crossbowmen
		SIZE = 8
	}
	create_maa_or_upgrade_regiment_effect = {
		TYPE = trebuchet
		SIZE = 8
	}
}

add_bulgarian_resistance_trait_effect = {
	if = {
		limit = {
			has_game_rule = bulgarian_resistance_trait_major
		}
		add_trait = bulgarian_resistance_major
	}
	else_if = {
		limit = {
			has_game_rule = bulgarian_resistance_trait_moderate
		}
		add_trait = bulgarian_resistance
	}
	else_if = {
		limit = {
			has_game_rule = bulgarian_resistance_trait_minor
		}
		add_trait = bulgarian_resistance_minor
	}
}

bulgarian_crown_effect = {
	create_title_and_vassal_change = {
		type = created
		save_scope_as = change
		add_claim_on_loss = no
	}
	title:k_bulgaria = {
		change_title_holder = {
			holder = scope:attacker
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
	scope:attacker = {
		set_realm_capital = c_turnovo
	}
}